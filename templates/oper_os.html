
<template>
    <style>
        #lblTotal{
            font-weight: bolder;
            font-size: 1.4em;
            padding: 20px;
            display: none;
            width: 100%;
            text-align: right;
        }

        #btnRelat{
            width: 98%;
            display: none;
        }

        #btnNova{
            width: 97%;
        }


    </style>

        <fieldset class="fds-busca compra">
            <legend>Filtro:</legend>
    
            <div class="inline">
                <label for="edtBusca">Serviço</label>
                <input type="text" id="edtBusca" placeholder="Digite sua Busca" onkeypress="return getEnter(event, 'btnBusca')">
                <button id="btnBusca" class="btn-round"><span class="mdi mdi-magnify"></span></button>
                <button id="btnNovo" class="btn-round"><span class="mdi mdi-plus-thick"></span></button>
            </div>
            <div class="inline center-itens">
                <div class="line-ckb">
                    <label for="ckbData">Início/Final</label>
                    <input type="checkbox" id="ckbData" checked>
                </div>

                <input type="date" id="edtIni">
                <input type="date" id="edtFin">
            </div>            
        </fieldset>

        <table id="tblOS"></table>
          


</template>
<script>

    const pageData = main_data.oper_os.data
    const pageFunc = main_data.oper_os.func
    const pageScreen = document.querySelector('#card-oper_os')


    pageFunc.pageStart = ()=>{
        pageScreen.querySelector('#edtIni').value =  today.getFormatDate()
        pageScreen.querySelector('#edtFin').value =  today.overday(30)
    }

    pageFunc.fillOS = ()=>{      
        const tbl = pageScreen.querySelector('#tblOS')
        tbl.innerHTML = ''
        const params = new Object;
            params.proc = pageScreen.querySelector('#edtBusca').value
            params.dt_ini = pageScreen.querySelector('#edtIni').value
            params.dt_fin = pageScreen.querySelector('#edtFin').value
        const myPromisse = queryDB(params,'OS-0')
        myPromisse.then((resolve)=>{
            const json = JSON.parse(resolve)
            tbl.style.display = json.length > 0 ? 'inline-table' : 'none'
            tbl.head('Serviço, Cliente, Entrega,<span class="mdi mdi-check-bold"></span>')
            for(let i=0; i<json.length; i++){
                tbl.plot(json[i],'processo,cliente,dt_entrega,aberta','Upp,Upp,dat,ico 1=mdi-close-thick 0=mdi-check-bold ')
            }

        })
    }

    pageScreen.querySelector('#btnBusca').addEventListener('click',()=>{
        pageFunc.fillOS()
    })

    pageScreen.querySelector('#btnNovo').addEventListener('click',()=>{
        openHTML('oper_view_os.html','pop-up','Order de Serviço')
    })

    pageScreen.querySelector('#tblOS').addEventListener('click',(e)=>{       
        data = e.target.parentNode.data
        data != undefined ? openHTML('oper_view_os.html','pop-up',`Ordem de Serviço - ${data.id}`,data) : null
    })

    pageFunc.pageStart()

</script>